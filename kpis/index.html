<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Instructions to retrieve data for KPIs population &mdash; Interlink  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Internationalization" href="../internationalization/index.html" />
    <link rel="prev" title="Logging Instruction for Microservices" href="../logging/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Interlink
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../environments/index.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collaborativeenvironment/index.html">Collaborative environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interlinkers/index.html">Interlinkers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/acceptance-tests/index.html">User Acceptance testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging/index.html">Logging Instruction for Microservices</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Instructions to retrieve data for KPIs population</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#exploiting-the-data-model">Exploiting the Data Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#endpoints-for-kpis">Endpoints for KPIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manually-querying-the-interlink-data-model">MANUALLY Querying the INTERLINK Data Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exploiting-the-user-behaviour-logs-in-interlink">Exploiting the user behaviour logs in INTERLINK</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#issuing-queries-with-grafana-logql">Issuing queries with Grafana LogQL</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../internationalization/index.html">Internationalization</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Interlink</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Instructions to retrieve data for KPIs population</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/kpis/index.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="instructions-to-retrieve-data-for-kpis-population">
<h1>Instructions to retrieve data for KPIs population<a class="headerlink" href="#instructions-to-retrieve-data-for-kpis-population" title="Permalink to this heading"></a></h1>
<p>INTERLINK needs to feed several KPIs regarding how the co-production process is carried out with the support of the Collaborative Environment and INTERLINKERs and some statistics regarding the teams created, coproduction projects and so on an so forth.</p>
<p>There are two sources from where the designed KPIs can be fed, namely:</p>
<ol class="arabic simple">
<li><p>Queries to INTERLINK Data Model</p></li>
<li><p>Queries to Grafana Loki where user activity logging is stored</p></li>
</ol>
<section id="exploiting-the-data-model">
<h2>Exploiting the Data Model<a class="headerlink" href="#exploiting-the-data-model" title="Permalink to this heading"></a></h2>
<section id="endpoints-for-kpis">
<h3>Endpoints for KPIS<a class="headerlink" href="#endpoints-for-kpis" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>DEV: https://dev.interlink-project.eu/coproduction/kpis</p></li>
<li><p>DEMO: https://demo.interlink-project.eu/coproduction/kpis</p></li>
<li><p>MEF: https://mef.interlink-project.eu/coproduction/kpis</p></li>
<li><p>ZARAGOZA: https://zgz.interlink-project.eu/coproduction/kpis</p></li>
<li><p>VARAM: https://varam.interlink-project.eu/coproduction/kpis</p></li>
</ul>
<blockquote>
<div><p>The script is located at:
https://github.com/interlink-project/backend-coproduction/blob/master/coproduction/app/kpis.py</p>
</div></blockquote>
</section>
<section id="manually-querying-the-interlink-data-model">
<h3>MANUALLY Querying the INTERLINK Data Model<a class="headerlink" href="#manually-querying-the-interlink-data-model" title="Permalink to this heading"></a></h3>
<p>This section illustrates how to perform queries to the database of co-production exploiting its <a class="reference external" href="https://dev.interlink-project.eu/docs/en/collaborativeenvironment/datamodel/index.html">data model</a></p>
<p>The steps to be carried out are:</p>
<ol class="arabic simple">
<li><p>Go to <a class="reference external" href="https://www.portainer.io/">Portainer</a> front-end for the microservices contenerized in INTERLINK: https://portainer.dev.interlink-project.eu/. Notice that you should change “dev” for the deployment that you want to extract data from.</p></li>
<li><p>Log in as	admin / ADMIN_PASSWORD</p></li>
<li><p>Choose “Containers” in left hand side menu</p></li>
<li><p>Pick the required container, i.e. <code class="docutils literal notranslate"><span class="pre">dev-interlink-project-eu-db</span></code></p></li>
<li><p>Open a &gt;_Console</p></li>
<li><p>Type in the following command to connect to the database: <code class="docutils literal notranslate"><span class="pre">psql</span> <span class="pre">postgresql://postgres:changethis&#64;localhost:5432</span></code></p></li>
<li><p>Based on the <a class="reference external" href="https://dev.interlink-project.eu/docs/en/collaborativeenvironment/datamodel/index.html">Data Model diagram</a> or the tables descriptions returned by Postgres issue queries.</p></li>
</ol>
<p>Check these other schemas to understand better how entities are modelled in INTERLINK:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/interlink-project/backend-coproduction/blob/master/coproduction/dbschema.png">Coproduction DB Schema</a></p></li>
<li><p><a class="reference external" href="https://github.com/interlink-project/backend-catalogue/blob/master/catalogue/dbschema.png">Catalogue DB Schema</a></p></li>
</ul>
<p>Some <a class="reference external" href="https://www.postgresql.org/docs/current/app-psql.html">PLSQL commands</a> which can be useful are documented in article  <a class="reference external" href="https://chartio.com/resources/tutorials/how-to-list-databases-and-tables-in-postgresql-using-psql/">“How to List Databases and Tables in PostgreSQL Using psql”</a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">\\list</span></code> or <code class="docutils literal notranslate"><span class="pre">\\l</span></code> to view all of the defined databases on the server, e.g. <code class="docutils literal notranslate"><span class="pre">\\l</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\\connect</span></code> or <code class="docutils literal notranslate"><span class="pre">\\c</span></code> to jump between databases, e.g. <code class="docutils literal notranslate"><span class="pre">\\c</span> <span class="pre">sales</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\\describe</span></code> or <code class="docutils literal notranslate"><span class="pre">\\dt</span></code> to list the tables in a database, e.g.<code class="docutils literal notranslate"><span class="pre">\\dt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\\d</span></code> to figure out internal structure of a table in a database, e.g. <code class="docutils literal notranslate"><span class="pre">\\d</span> <span class="pre">coproductionprocess</span></code></p></li>
</ul>
<p>To run a examplary query perform the following commands:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">\\l</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\c</span> <span class="pre">coproduction_production</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\\dt</span></code> to list the tables of DB coproduction_production</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\\d</span> <span class="pre">coproduction_production</span></code> to figure out the internal structure of the table</p></li>
<li><p>Run different SQL commands, e.g. <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">coproduction_production</span></code></p></li>
</ul>
<p>Alternatively you may execute this single command:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">psql</span> <span class="pre">postgresql://postgres:changethis&#64;localhost:5432/coproduction_production</span> <span class="pre">-c</span> <span class="pre">'select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">coproductionprocess';</span></code></p></li>
</ul>
</section>
</section>
<section id="exploiting-the-user-behaviour-logs-in-interlink">
<h2>Exploiting the user behaviour logs in INTERLINK<a class="headerlink" href="#exploiting-the-user-behaviour-logs-in-interlink" title="Permalink to this heading"></a></h2>
<section id="issuing-queries-with-grafana-logql">
<h3>Issuing queries with Grafana LogQL<a class="headerlink" href="#issuing-queries-with-grafana-logql" title="Permalink to this heading"></a></h3>
<p>Grafana uses its own query language called <a class="reference external" href="https://grafana.com/docs/loki/latest/logql/">LogQL</a> to query data from <a class="reference external" href="https://grafana.com/docs/loki/latest/">LOKI</a> o any other source.</p>
<p>There are many tutorials online that be followed to learn LogQL:</p>
<ul class="simple">
<li><p>LogQL <a class="reference external" href="https://grafana.com/docs/loki/latest/logql/">documentation</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=HDpE9v1Syz8">Youtube video</a> ilustrating how to perform queries over Grafana Loki with LogQL</p></li>
</ul>
<p>Some exemplary queries are illustrated below:</p>
<ul class="simple">
<li><p>Count the INTERLINKERs created in a time period</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sum(count_over_time({container_name=~&quot;.*-interlink-project-eu-logging&quot;,job=&quot;user_loging&quot;}[$interval] | json | (crud=&quot;false&quot; or frontend=&quot;true&quot;) and action=&quot;CREATE&quot; and model=&quot;ASSET&quot; and external_interlinker=&quot;false&quot;))
</pre></div>
</div>
<ul class="simple">
<li><p>List the times that distinct knowledge interlinkers have been created</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sum by (knowledgeinterlinker_name)(count_over_time({container_name=~&quot;.*-interlink-project-eu-logging&quot;,job=&quot;user_loging&quot;}[$interval] | json | (crud=&quot;false&quot; or frontend=&quot;true&quot;) and action=&quot;CREATE&quot; and model=&quot;ASSET&quot; and external_interlinker=&quot;false&quot; and knowledgeinterlinker_name!=&quot;&quot;))
</pre></div>
</div>
<ul class="simple">
<li><p>List the times that distinct software interlinkers have been instantiated</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sum by (softwareinterlinker_name)(count_over_time({container_name=~&quot;.*-interlink-project-eu-logging&quot;,job=&quot;user_loging&quot;}[$interval] | json | (crud=&quot;false&quot; or frontend=&quot;true&quot;) and action=&quot;CREATE&quot; and model=&quot;ASSET&quot; and external_interlinker=&quot;false&quot;))
</pre></div>
</div>
<ul class="simple">
<li><p>Count the number of co-production processes created</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sum (count_over_time({container_name=~&quot;.*-interlink-project-eu-logging&quot;,job=&quot;user_loging&quot;}[$interval] | json | (crud=&quot;false&quot; or frontend=&quot;true&quot;) and action=&quot;CREATE&quot; model=&quot;COPRODPROCESS&quot;))
</pre></div>
</div>
<ul class="simple">
<li><p>Count the number of teams created per user</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sum by (user_id)(count_over_time({container_name=~&quot;.*-interlink-project-eu-logging&quot;,job=&quot;user_loging&quot;}[$interval] | json | (crud=&quot;false&quot; or frontend=&quot;true&quot;) and action=&quot;CREATE&quot; model=&quot;TEAM&quot;))
</pre></div>
</div>
<p>Notice the following regarding the above queries:</p>
<ul class="simple">
<li><p>LogQL works not over all existing data (which is stream), but on a data over some period of time, hence the parameter $interval which is used. You should also somehow have it in your queries.</p></li>
<li><p><a class="reference external" href="https://grafana.com/docs/loki/latest/logql/log_queries/#json">json</a> parser allows a user to parse and extract labels from the log content</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../logging/index.html" class="btn btn-neutral float-left" title="Logging Instruction for Microservices" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../internationalization/index.html" class="btn btn-neutral float-right" title="Internationalization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Interlink team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>