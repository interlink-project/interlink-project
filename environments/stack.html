<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overall stack &mdash; Interlink  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SW development, CI &amp; CD policies for INTERLINK software" href="cicd.html" />
    <link rel="prev" title="Local (development) environment" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Interlink
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Environments</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Local (development) environment</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Overall stack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environments">Environments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-components">Main components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#routing-with-traefik">Routing with traefik</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cicd.html">SW development, CI &amp; CD policies for INTERLINK software</a></li>
<li class="toctree-l2"><a class="reference internal" href="update.html">Environments update</a></li>
<li class="toctree-l2"><a class="reference internal" href="administration.html">Environments administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging Instruction for Microservices</a></li>
<li class="toctree-l2"><a class="reference internal" href="kpis.html">KPI obtention</a></li>
<li class="toctree-l2"><a class="reference internal" href="weblate.html">Weblate for continous localization</a></li>
<li class="toctree-l2"><a class="reference internal" href="google.html">Google keys</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../collaborativeenvironment/index.html">Collaborative environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/acceptance-tests/index.html">User Acceptance testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other_problems.html">Errors</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Interlink</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Environments</a> &raquo;</li>
      <li>Overall stack</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/environments/stack.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="overall-stack">
<h1>Overall stack<a class="headerlink" href="#overall-stack" title="Permalink to this heading"></a></h1>
<section id="environments">
<h2>Environments<a class="headerlink" href="#environments" title="Permalink to this heading"></a></h2>
<p>Each of the folders corresponds to a self-contained environmennt, the folder could be moved or copied to a different location.
The environments do not have dependencies within this repository and download the component images from Docker Hub (in principle images will be public so no authentication is needed).</p>
<p>At least, six different environment configuration will be available for INTERLINK, corresponding to the folders in this repository:</p>
<ul class="simple">
<li><p><strong>local</strong>: environment for deploying the components of the INTERLINK platform in a local private machine. It does not use SSL/TLS and will be deployed in <a class="reference external" href="http://localhost">localhost</a>. It can be useful as a basis for developing and integrating components. It is expected to match latest development edge (master/main branches of the components) and data is in general not persisted.</p></li>
<li><p><strong>development</strong>: integration environment that will be deployed in <a class="reference external" href="https://dev.interlink-project.eu">dev.interlink-project.eu</a>. It is expected to be automarically updated with the latest development edge (master/main branches of the components) and data is in general not persisted and will likely be overwrote with sample default data in each new re-deployment.</p></li>
<li><p><strong>demo</strong>: central demo or staging environment <a class="reference external" href="https://demo.interlink-project.eu">demo.interlink-project.eu</a> to demostrate new features and carry out demonstration. In general, data persistence and version stability (no latest images but fixed tagged versions) should be ensured.</p></li>
<li><p><strong>pilot-zgz</strong>: pilot environment <a class="reference external" href="https://pilot-zgz.interlink-project.eu">pilot-zgz.interlink-project.eu</a>. Production-like environment, data persistence and version stability (no latest images but fixed tagged versions) should be ensured.</p></li>
<li><p><strong>pilot-mef</strong>: pilot environment <a class="reference external" href="https://pilot-mef.interlink-project.eu">pilot-mef.interlink-project.eu</a>. Production-like environment, data persistence and version stability (no latest images but fixed tagged versions) should be ensured.</p></li>
<li><p><strong>pilot-varam</strong>: pilot environment for <a class="reference external" href="https://pilot-varam.interlink-project.eu">pilot-varam.interlink-project.eu</a>. Production-like environment, data persistence and version stability (no latest images but fixed tagged versions) should be ensured.</p></li>
</ul>
<p>For now, the environments are deployed in a single machine with Docker Compose. The might change in the future, as well The naming or the URLs of these images might change in the future.</p>
<p>All the environments deploy the same docker-compose stack.</p>
<blockquote>
<div><p>https://github.com/interlink-project/interlink-project/blob/master/envs/development/docker-compose.yml
https://github.com/interlink-project/interlink-project/blob/master/envs/demo/docker-compose.yml
https://github.com/interlink-project/interlink-project/blob/master/envs/pilot-zgz/docker-compose.yml
https://github.com/interlink-project/interlink-project/blob/master/envs/pilot-mef/docker-compose.yml
https://github.com/interlink-project/interlink-project/blob/master/envs/pilot-varam/docker-compose.yml</p>
</div></blockquote>
<p>This docker composes depend on the .env files present in the directories. Those are used to define some of the environment variables dependant on the environment.</p>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>The only software requirement for the deployment of the environment is a working installation of docker and docker-compose (ideally witout the need of using sudo) with support to standard amd64 architecture images (most standard installations would work).</p>
<p>In addition, for the environments that are expected to be publicly available, it is necesary to have a machine with a public IP and to point the corresponding subdomains to the machine public address.</p>
</section>
<section id="main-components">
<h2>Main components<a class="headerlink" href="#main-components" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong><a class="reference external" href="https://github.com/interlink-project/backend-auth">backend-auth</a>:</strong> FastAPI app that implements the OIDC logic to create samesite cookies in order to authenticate the requests made behind the domain it is being executed on. For example, if backend-auth is being executed in localhost, captures the callback from the AAC (authentication external module) and creates a samesite cookie for that domain.</p></li>
<li><p><strong><a class="reference external" href="https://github.com/interlink-project/backend-catalogue">backend-catalogue</a>:</strong> FastAPI app that exposes an HTTP API for storing / retrieving information about some of the data entities implemented. The main idea for this service is to keep as static as possible, to be able (in the future) to cache the responses in order to gain sustancial efficiency. The entities managed by this service are, for example, users, interlinkers, coproduction schemas… those that are not modified as frequently as the ones in the backend-coproduction service.</p></li>
<li><p><strong><a class="reference external" href="https://github.com/interlink-project/backend-coproduction">backend-coproduction</a>:</strong> FastAPI app that exposes an HTTP API for storing / retrieving information about some of the data entities implemented for the co-production. The entities managed are frequently modified, such as coproductionprocesses, assets, permissions…</p></li>
<li><p><strong><a class="reference external" href="https://github.com/interlink-project/backend-logging">backend-logging</a>:</strong> FastAPI app that exposes an HTTP API that the services (in the same network) can use to log events.</p></li>
<li><p><strong><a class="reference external" href="https://github.com/interlink-project/frontend">frontend</a>:</strong>:</p>
<ul>
<li><p>In development: React app that serves the graphical user interface.</p></li>
<li><p>In production: nginx that serves the static files resulted from the build of the react codebase.</p></li>
</ul>
</li>
<li><p><strong><a class="reference external" href="https://github.com/interlink-project/interlinker-ceditor">interlinker-ceditor</a>:</strong> FastAPI app that exposes an API to create and access documents in the Etherpad instance deployed.</p></li>
<li><p><strong><a class="reference external" href="https://github.com/interlink-project/interlinker-googledrive">interlinker-googledrive</a>:</strong> FastAPI app that exposes an API and a GUI to create documents in Google Drive cloud.</p></li>
<li><p><strong><a class="reference external" href="https://github.com/interlink-project/interlinker-survey">interlinker-survey</a>:</strong> FastAPI app that exposes an API and a GUI to create surveys.</p></li>
</ul>
</section>
<section id="routing-with-traefik">
<h2>Routing with traefik<a class="headerlink" href="#routing-with-traefik" title="Permalink to this heading"></a></h2>
<p>Traefik allows to configure the routing by defining some labels in the docker-compose as it can be seen in the auth service.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="s">&quot;3.9&quot;</span>
<span class="nt">services</span><span class="p">:</span>

  <span class="c1"># Traefik Service, reverse proxy and load balancing</span>
  <span class="nt">proxy</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">traefik:v2.6.6</span>
    <span class="nt">ports</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;80:80&quot;</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;443:443&quot;</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;8090:8080&quot;</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./letsencrypt:/letsencrypt</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock</span>
    <span class="nt">command</span><span class="p">:</span>
      <span class="c1"># Enable Docker in Traefik, so that it reads labels from Docker services</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--providers.docker=true</span>
      <span class="c1"># Do not expose all Docker services, only the ones explicitly exposed</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--providers.docker.exposedbydefault=false</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--entrypoints.web.address=:80</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--entrypoints.websecure.address=:443</span>
      <span class="c1"># Redirect Http to Https</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--entrypoints.web.http.redirections.entryPoint.to=websecure</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--entrypoints.web.http.redirections.entryPoint.scheme=https</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--entrypoints.web.http.redirections.entrypoint.permanent=true</span>
      <span class="c1"># Enable the access log, with HTTP requests</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--accesslog</span>
      <span class="c1"># Enable the Traefik log, for configurations and errors</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--log</span>
      <span class="c1"># Enable the Dashboard and API</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--api</span>
      <span class="c1"># Enable the Dashboard and API in insecure mode for local development</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--api.insecure=true</span>
      <span class="c1"># - --certificatesresolvers.letsencrypt.acme.tlschallenge=true</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--certificatesresolvers.letsencrypt.acme.email=apps@interlink-project.eu</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json</span>

      <span class="c1"># httpchallenge</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--certificatesresolvers.letsencrypt.acme.httpchallenge=true</span>

    <span class="nt">labels</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.http-catchall.rule=hostregexp(`{host:.+}`)</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.http-catchall.entrypoints=web</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.http-catchall.middlewares=redirect-to-https</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.http.middlewares.redirect-to-https.redirectscheme.scheme=https</span>
    <span class="nt">networks</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik-public</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>

  <span class="nt">auth</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.enable=true</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.docker.network=traefik-public</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.http.services.${PLATFORM_STACK_NAME}-auth.loadbalancer.server.port=${PORT}</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.${PLATFORM_STACK_NAME}-auth.entrypoints=websecure</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.${PLATFORM_STACK_NAME}-auth.tls.certresolver=letsencrypt</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.${PLATFORM_STACK_NAME}-auth.tls=true</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.${PLATFORM_STACK_NAME}-auth.rule=Host(`${DOMAIN}`) &amp;&amp; PathPrefix(`/auth`)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="Local (development) environment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cicd.html" class="btn btn-neutral float-right" title="SW development, CI &amp; CD policies for INTERLINK software" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Interlink team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>